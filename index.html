<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Wireframe Globe Minimaliste + Continents Only + Épingles + Labels</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body { background: #fff; }
    #globeViz { width: 100vw; height: 100vh; }
    #globeViz canvas { background: #fff !important; }
  </style>
  <script src="https://unpkg.com/three@0.150.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.150.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <div id="globeViz"></div>
  <script>
    const maskUrl = 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Equirectangular_projection_SW.jpg'; // continents en blanc, océan en noir

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 0, 3);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('globeViz').appendChild(renderer.domElement);

    // OrbitControls pour tourner le globe à la souris
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // Globe wireframe dense, applique le masque des continents
    const globeRadius = 1;
    const geometry = new THREE.SphereGeometry(globeRadius, 128, 128);

    // Charger le masque des continents
    new THREE.TextureLoader().load(maskUrl, function(texture) {
      const material = new THREE.MeshBasicMaterial({
        color: 0x222222,
        wireframe: true,
        map: texture,
        alphaTest: 0.8, // n'affiche le wireframe que sur les continents (blancs du masque)
        transparent: true
      });
      const globe = new THREE.Mesh(geometry, material);
      scene.add(globe);

      // Animation du globe
      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    });

    // Lumière (facultative pour wireframe, utile pour les épingles)
    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);

    // Données des villes/épingles
    const pinsData = [
      { lat: 48.8566, lng: 2.3522, name: "Paris" },
      { lat: 52.52, lng: 13.405, name: "Berlin" },
      { lat: 40.7128, lng: -74.006, name: "New York" }
    ];

    // Ajout des épingles et labels
    pinsData.forEach(p => {
      const phi = (90 - p.lat) * Math.PI / 180;
      const theta = (p.lng + 180) * Math.PI / 180;
      const R = globeRadius;

      const x = R * Math.sin(phi) * Math.cos(theta);
      const y = R * Math.cos(phi);
      const z = R * Math.sin(phi) * Math.sin(theta);

      // Épingles sobres
      const pinGeo = new THREE.CylinderGeometry(0.01, 0.01, 0.18, 16);
      const pinMat = new THREE.MeshStandardMaterial({ color: 0x000000, transparent: true, opacity: 0.7 });
      const pin = new THREE.Mesh(pinGeo, pinMat);

      pin.position.set(x, y, z);
      const normal = new THREE.Vector3(x, y, z).normalize();
      pin.quaternion.setFromUnitVectors(new THREE.Vector3(0,1,0), normal);
      pin.position.multiplyScalar(1.03);

      scene.add(pin);

      // Label Sprite
      const canvas = document.createElement('canvas');
      canvas.width = 128;
      canvas.height = 32;
      const ctx = canvas.getContext('2d');
      ctx.font = '18px Arial';
      ctx.fillStyle = '#222';
      ctx.fillText(p.name, 10, 22);
      const texture = new THREE.CanvasTexture(canvas);
      const spriteMat = new THREE.SpriteMaterial({ map: texture, transparent: true });
      const sprite = new THREE.Sprite(spriteMat);
      sprite.scale.set(0.3, 0.08, 1);
      sprite.position.set(x * 1.08, y * 1.08, z * 1.08);
      scene.add(sprite);
    });

    // Gestion du redimensionnement
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
